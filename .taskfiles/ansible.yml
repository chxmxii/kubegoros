version: '3'

vars:
  ANSIBLE_INVENTORY: "inventory"
  
tasks:
  init:
    silent: true
    cmds:
      - echo "Initializing the Kubernetes cluster..." && ansible-playbook ansible/playbooks/cluster.yml --tags "cluster"
    preconditions:
      - {msg: "Missing Ansible Inventory file", sh: "test -f {{.ANSIBLE_INVENTORY}}" }
  
  reset:
    silent: true
    cmds:
      - echo "Resetting the Kubernetes cluster..." && ansible-playbook ansible/playbooks/reset.yml
    preconditions:
      - {msg: "Missing Ansible Inventory file", sh: "test -f {{.ANSIBLE_INVENTORY}}" }
        
  upgrade:
    silent: true
    cmds:
      - echo "Upgrading the Kubernetes cluster..." && ansible-playbook ansible/playbooks/upgrade.yml
    preconditions:
      - {msg: "Missing Ansible Inventory file", sh: "test -f {{.ANSIBLE_INVENTORY}}" }
        
  check:
    silent: true
    cmds:
      - echo "Checking host connectivity..." && ansible kube_cluster -m ping
    preconditions:
      - {msg: "Missing Ansible Inventory file", sh: "test -f {{.ANSIBLE_INVENTORY}}" }

  list:
    silent: true
    cmds:
      - echo "Listing all the hosts..." && ansible-inventory --graph
    preconditions:
      - {msg: "Missing Ansible Inventory file", sh: "test -f {{.ANSIBLE_INVENTORY}}" }

  shutdown:
    silent: true
    cmds:
      - echo "Shutting down all the nodes..." && ansible all -a 'systemctl poweroff' -b
    preconditions:
      - {msg: "Missing Ansible Inventory file", sh: "test -f {{.ANSIBLE_INVENTORY}}" }
  
  
